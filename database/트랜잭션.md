# 트랜잭션

태그: DB

### 트랜잭션이란

- 트랜잭션은 데이터베이스 내에서 수행되는 작업의 최소 단위
- 데이터베이스의 무결성을 유지하면서 DB의 상태 변화 수행
- 하나 이상의 쿼리를 포함한다.
- ACID를 만족해야함
- 트랜잭션을 통해 논리적 단위를 수행하며 데이터 갱신과 복구의 단위이다.

### ACID

- Atomicity(원자성) : 트랜잭션에 포함된 작업은 전부 수행되거나 전부 수행되지 말아야한다.
- Consistency(일관성) : 트랜잭션이 완료되면 언제나 일관성있는 DB상태를 유지하는 것
- Isolation(고립성) : 여러 트랜잭션이 동시에 수행될때 각 트랜잭션이 다른 트랜잭션 작업에 끼어들지 못하도록 보장하여 독립적으로 작업을 수행하는 것
- Durability(지속성) : 성공적으로 수행된 트랜잭션은 데이터베이스에 영원히 반영되어야 함을 의미

### DB 동시성제어

- 여러개의 트랜잭션이 한 개의 데이터를 동시에 갱신할 때 한 트랜잭션의 갱신이 무효화 될 수 있음
- 이것을 갱신 손실이라고 한다.
- 동시성제어를 통해 갱신손실을 막을 수 있다.
- 즉, 트랜잭션이 동시에 수행될 때 일관성을 해치지 않도록 데이터 접근을 제어하는 것을 의미한다.
- 갱신손실 문제를 해결하기 위해서 트랜잭션이 수행되는 데이터는 Lock으로 잠금하여 다른 트랜잭션이 해당 데이터에 접근하지 못하게 하는 방법이 있다.

### 커밋과 롤백

- 커밋과 롤백을 통해 데이터의 무결성을 보장한다.
- 커밋은 트랜잭션이 작업을 완료했다고 확정하는 것, 커밋을 통해 데이터베이스가 갱신된다.
- 롤백은 문제가 발생했을 때, 발생한 변경사항을 취소하고 이전 커밋 상태로 되돌린다.

### DB 데드락

- 여러 트랜잭션들이 각 자신의 데이터에 대해 Lock을 획득한 상태에서 상대방 데이터에 대해 접근하고자 대기 할때 서로 대기가 지속되어 영원히 처리되지 않은 상황
- 예방기법, 회피기법, 탐지 및 회복 기법을 통해 데드락을 해결할 수 있다.
- 예방기법 : 각 트랜잭션이 실행되기전 사용될 모든 데이터를 미리 lock하는 것
- 회피기법 : timestamp를 활용하여 데드락이 발생하지 않도록 회피
- 탐지 및 회복기법 : 데드락이 발생하면 이를 감지하고 회복시키는 기법