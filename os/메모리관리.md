# 메모리 관리

태그: OS

### 사전 용어 정리

- 논리적 주소 : 프로세스가 메모리에 적재되기 위한 독자적인 주소 공간
- 물리적 주소 : 프로세스가 실제로 메모리에 적재되는 위치
- 주소 바인딩 : 프로세스의 논리적 주소가 실제 물리적 메모리의 어느 위치에 매핑되는지 확인하는 과정

### 논리적 주소와 물리적 주소가 필요한 이유?

- 논리적 주소는 CPU가 생성하는 가상 주소의 개념이다.
- 물리적 주소는 실제 메모리(RAM)에서 해당 데이터가 저장된 위치
- 프로세스 간 메모리 독립성을 유지하기 위해 사용한다.
- 논리적 주소와 물리적 주소를 같이 사용하면 프로세스를 실행할 때 항상 동일한 물리적 주소 공간에 적재할 수 없는데 논리적 주소를 사용하면 항상 동일한 주소에서 실행되는 것 처럼 보이게 됨
- 가상 메모리 사용을 위해서도 필요하다고 볼 수 있음. 논리적 주소를 사용해서 물리적 메모리가 부족한 경우 디스크로 일부 데이터를 이동 시킬 수 있는데 물리적 주소만을 사용하면 가상 메모리 기법을 사용하는 것이 불가능해짐

### 페이징

- 페이징이란 프로세스가 할당받은 메모리 공간을 고정 크기의 ‘페이지 단위로 나누어 물리 메모리에 연속되지 않는 서로 다른 위치에 저장하는 메모리 관리 기법
- 물리적 메모리를 페이지와 동일한 크기의 프레임으로 미리 나누어둔다.
- 페이징 기법에서는 주소 바인딩을 위해 모든 프로세스가 각각의 주소 변환을 위한 페이지 테이블을 갖는다.
- 페이징 기법에서는 내부 단편화 문제가 발생할 수 있다.

### 내부 단편화

- 고정된 크기의 메모리 블록을 할당할 때, 실제 사용되지 않는 낭비된 공간이 발생하는 현상
- 페이지 단위가 고정되어 있기 때문에 낭비되는 공간이 발생하는 것임

### 세그멘테이션

- 프로세스가 할당받은 메모리 공간을 논리적 의미 단위로 메모리를 할당하는 기법
- 각 세그먼트는 연속된 물리 메모리 공간에 배치되어야 한다.
- 세그멘테이션 기법에서는 외부 단편화 문제가 발생할 수 있다.

### 외부 단편화

- 가변 크기의 메모리 블록을 할당할 때, 사용 가능한 전체 메모리 공간은 충분하지만, 연속된 공간이 부족하여 새로운 프로세스를 할당할 수 없는 현상
- 연속된 공간을 차지해야 하기 때문에 메모리 공간은 남아있지만 새로운 세그먼트를 할당할 수는 없는 문제임
- 압축 기법을 통해 연속적인 공간을 확보한다.

### 페이지드 세그멘테이션

- 세그멘테이션의 논리적 구조를 유지하면서 페이징의 비연속적 할당을 결합한 방식
- 세그멘테이션의 문제점인 외부 단편화를 해결하기 위해 세그먼트를 다시 작은 페이지 단위로 쪼개어 저장하는 방식
- 세그먼트 자체를 페이지 단위로 나누어서 비연속적인 물리 메모리 할당이 가능하도록 개선한 것
- 이를 통해 세그멘테이션 기법에서 발생하던 문제점인 외부단편화 문제는 해결할 수 있지만 페이지로 크기가 고정되어있어 내부 단편화는 여전히 발생할 수 있다.
- 세그먼트 테이블 + 페이지 테이블로 추가변환 과정이 있어서 속도가 느려질 수 있음

### 가상 메모리

- 실제 물리 메모리 개념과 개발자 입장의 논리 메모리 개념을 분리한 것
- 이를 통해 개발자는 메모리 크기에 관련한 문제를 걱정할 필요 없이 쉽게 프로그램 구현이 가능하다.
- 운영체제는 가상메모리 기법을 통해 논리적 주소 영역에서 필요한 부분만 물리적 메모리에 적재하고, 직접적으로 필요하지 않은 메모리 공간은 디스크 영역에 저장함
- 이 디스크 영역을 스왑영역이라고 한다.

### 요구 페이징

- 당장 사용될 주소 공간을 페이지 단위로 메모리에 적재하는 방법
- CPU의 요청이 들어오면 특정 Page를 메모리에 적재함
- 당장 실행에 필요한 페이지만을 메모리에 적재하기 때문에 메모리 사용량이 감소하고 프로세스 전체를 메모리에 적재하는 비효율이 감소됨
- 유효, 무효 비트를 통해서 각 페이지가 메모리에 존재하는 지를 표시함
- 페이지 폴트
    - CPU가 무효 비트로 표시된 페이지에 접근하는 상황을 page fault라고 한다.
    - 이때 주소 변환을 담당하는 하드웨어인 MMU가 페이지 폴트 트랩을 발생시킴
    - 디스크에서 해당 페이지를 빈 프레임에 적재시키고 페이지 테이블을 업데이트 한다.
    - 그리고 무효 비트를 유효비트로 바꾼다.
    

### 페이지 교체 알고리즘

- 페이지 폴트가 발생하면 요청된 페이지를 디스크에서 메모리로 가져옴
- 근데 이때 물리적 메모리 공간이 부족하게 되면 메모리에 올라와 있는 페이지를 디스크로 옮겨서 메모리 공간을 확보함
- 이것을 페이지 교체 알고리즘이라고 한다.
- 페이지 교체 알고리즘의 핵심은 최대한 페이지 폴트가 적게 일어나도록 하는 것임
- FIFO : 메모리에 올라온 페이지중 가장 오래된 페이지를 교체함
- 최적 페이지 교체 : 앞으로 가장 오랫동안 사용되지 않을 페이지를 찾아서 교체하는데 비현실적임
- LRU : 가장 오랫동안 사용되지 않은 페이지를 교체함
- LFU : 참조 횟수가 가장 적은 페이지를 교체함